<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>開發柴工作室 | 貓舍/寵物美容預約系統範本</title>
    
    <link rel="icon" href="logo.png" type="image/png">
    <link rel="apple-touch-icon" href="logo.png">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FAF8F5">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@300;400;500;700;900&family=Cormorant+Garamond:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { 
            theme: {
                extend: {
                    colors: {
                        theme: {
                            bg: '#FAF8F5',
                            rose: '#D88E99',
                            roseDeep: '#B56576',
                            gold: '#C5A065',
                            goldLight: '#E5CFA0',
                            text: '#4A4238',
                            sub: '#8C857B',
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'],
                        en: ['"Cormorant Garamond"', 'serif'],
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(74, 66, 56, 0.08)',
                        'glow': '0 0 20px rgba(216, 142, 153, 0.4)',
                    },
                    backgroundImage: {
                        'gradient-lux': 'linear-gradient(135deg, #D88E99 0%, #C5A065 100%)',
                        'shimmer': 'linear-gradient(45deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 60%)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'slide-up': 'slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards',
                        'float': 'float 4s ease-in-out infinite',
                        'shimmer': 'shimmer 2.5s infinite',
                        'bounce-slight': 'bounceSlight 2s infinite',
                    },
                    keyframes: {
                        fadeIn: { from: { opacity: '0' }, to: { opacity: '1' } },
                        slideUp: { from: { opacity: '0', transform: 'translateY(40px)' }, to: { opacity: '1', transform: 'translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-8px)' } },
                        shimmer: { '0%': { backgroundPosition: '-200% center' }, '100%': { backgroundPosition: '200% center' } },
                        bounceSlight: { '0%, 100%': { transform: 'translateY(-5%)' }, '50%': { transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #FAF8F5;
            background-image: radial-gradient(circle at 10% 20%, rgba(216, 142, 153, 0.08) 0%, transparent 40%), radial-gradient(circle at 90% 80%, rgba(197, 160, 101, 0.08) 0%, transparent 40%);
            font-family: 'Noto Serif TC', serif;
            color: #4A4238;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            line-height: 1.7;
        }
        h1, h2, h3, .font-serif { font-family: 'Noto Serif TC', serif; }
        a, button, input, select, textarea, label { touch-action: manipulation; }
        input, select, textarea { font-size: 16px !important; }
        .font-num, input[type="tel"], input[type="number"], .input-minimal { font-family: 'Cormorant Garamond', 'Noto Serif TC', serif; font-variant-numeric: tabular-nums; }
        
        .input-minimal {
            width: 100%; background: rgba(255, 255, 255, 0.6); border: 1px solid rgba(140, 133, 123, 0.2);
            padding: 0.8rem 1rem; font-size: 16px; color: #4A4238; transition: all 0.3s; border-radius: 12px; font-weight: 500;
        }
        .input-minimal:focus { background: #FFFFFF; border-color: #D88E99; outline: none; box-shadow: 0 4px 12px rgba(216, 142, 153, 0.15); transform: translateY(-1px); }
        .input-minimal.error { border-color: #EF4444; background: #FEF2F2; animation: shake 0.3s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .error-msg { color: #EF4444; font-size: 0.8rem; margin-top: 0.4rem; margin-left: 0.5rem; display: none; font-weight: 500; }

        .glass-panel { 
            background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(20px) saturate(140%);
            border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 8px 32px 0 rgba(74, 66, 56, 0.08); transition: all 0.4s;
        }
        .glass-panel:focus-within { background: rgba(255, 255, 255, 0.95); border-color: #D88E99; transform: scale(1.01); z-index: 10; }
        
        .btn-card { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.5); transition: all 0.3s; }
        .btn-card:hover { background: rgba(255, 255, 255, 0.9); transform: translateY(-4px); border-color: #D88E99; }
        .btn-card:active { transform: scale(0.96); }

        .checkbox-custom { appearance: none; background-color: #fff; width: 1.35em; height: 1.35em; border: 1.5px solid #D88E99; border-radius: 0.35em; display: grid; place-content: center; transition: 0.2s; cursor: pointer; }
        .checkbox-custom::before { content: ""; width: 0.75em; height: 0.75em; transform: scale(0); transition: 0.2s; box-shadow: inset 1em 1em #D88E99; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
        .checkbox-custom:checked::before { transform: scale(1); }

        .radio-group input:checked + div { background-color: rgba(216, 142, 153, 0.1); border-color: #D88E99; color: #4A4238; font-weight: bold; }
        .text-gradient { background: linear-gradient(135deg, #4A4238 30%, #B56576 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .text-gold-gradient { background: linear-gradient(to right, #B88746, #E5CFA0, #B88746); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shimmer 5s linear infinite; }
        
        label { font-size: 14px !important; font-weight: 700 !important; color: #1a1a1a !important; margin-bottom: 8px !important; }
        label span.text-rose-500 { color: #e11d48 !important; }
        .safe-pb { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #E5CFA0; border-radius: 10px; }
    </style>
</head>

<body class="min-h-screen relative flex flex-col">

    <nav class="fixed top-0 w-full z-50 transition-all duration-500 opacity-0 pointer-events-none" id="navbar">
        <div class="bg-white/70 backdrop-blur-xl border-b border-white/40 shadow-sm">
            <div class="px-6 py-4 flex justify-between items-center max-w-lg mx-auto">
                <div class="flex items-center gap-3" onclick="router('home')">
                    <div class="w-9 h-9 rounded-full bg-theme-bg border border-theme-rose/20 flex items-center justify-center overflow-hidden shadow-inner">
                         <img src="logo.png" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                         <i data-lucide="cat" class="hidden w-5 h-5 text-theme-rose"></i>
                    </div>
                    <span class="font-bold text-lg tracking-widest text-theme-text font-serif">開發柴工作室</span>
                </div>
                <button onclick="router('home')" class="flex items-center gap-1.5 text-xs font-bold text-theme-sub hover:text-theme-rose transition-colors tracking-[0.15em] uppercase border border-transparent hover:border-theme-rose/20 px-3 py-1.5 rounded-full">
                    <i data-lucide="arrow-left" class="w-3.5 h-3.5"></i> Back
                </button>
            </div>
        </div>
    </nav>

    <main class="flex-1 w-full max-w-lg mx-auto relative z-10 flex flex-col py-6 px-6">

        <div id="view-home" class="flex flex-col justify-center min-h-[90vh] py-8">
            <div class="w-full glass-panel rounded-[32px] p-10 text-center relative overflow-hidden animate-slide-up z-20 mb-8 group">
                <div class="absolute -top-24 -right-24 w-64 h-64 bg-theme-rose/10 rounded-full blur-3xl"></div>
                <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-theme-gold/10 rounded-full blur-3xl"></div>

                <div class="relative z-10 mb-8 flex justify-center">
                    <div class="w-44 h-44 rounded-full p-2 bg-gradient-to-br from-white/80 to-white/20 shadow-xl border border-white flex items-center justify-center animate-float ring-1 ring-white/50">
                        <div class="w-full h-full rounded-full overflow-hidden bg-white flex items-center justify-center relative">
                            <img src="logo.png" alt="Logo" class="w-full h-full object-cover transform transition duration-700 group-hover:scale-110" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                            <div class="hidden flex-col items-center justify-center gap-2 text-theme-rose/30">
                                <i data-lucide="cat" class="w-12 h-12"></i>
                                <span class="text-xs tracking-widest font-bold">SHIBA</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative z-10 space-y-3 mb-10">
                    <h1 class="text-3xl font-black tracking-[0.25em] leading-tight text-gradient font-serif">
                        開發柴工作室
                    </h1>
                    <div class="h-px w-24 bg-gradient-to-r from-transparent via-theme-rose/50 to-transparent mx-auto"></div>
                    <span class="font-en text-xl font-semibold text-gold-gradient tracking-[0.15em] block">
                        SHIBA STUDIO DEMO
                    </span>
                    <p class="text-xs text-theme-sub tracking-[0.3em] font-medium pt-2">
                        <span>客製化預約系統｜範本</span>
                    </p>
                </div>

                <div class="relative z-10">
                    <button onclick="router('form')" class="group relative w-full overflow-hidden rounded-xl shadow-lg hover:shadow-glow hover:-translate-y-1 transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-lux opacity-90 group-hover:opacity-100 transition"></div>
                        <div class="absolute inset-0 bg-shimmer bg-[length:200%_100%] animate-shimmer opacity-30"></div>
                        <div class="relative py-4 px-6 flex items-center justify-center gap-3">
                            <i data-lucide="feather" class="w-5 h-5 text-white group-hover:rotate-12 transition-transform duration-300"></i>
                            <span class="text-white font-bold text-lg tracking-[0.2em] font-serif">進入預約系統 (Demo)</span>
                            <i data-lucide="chevron-right" class="w-4 h-4 text-white/70 group-hover:translate-x-1 transition-transform"></i>
                        </div>
                    </button>
                    <p class="text-[10px] text-theme-sub mt-3 tracking-wider opacity-70 flex items-center justify-center gap-1">
                        <i data-lucide="info" class="w-3 h-3"></i> 此為展示範本，不儲存真實個資
                    </p>
                </div>
            </div>

            <div class="w-full space-y-3 animate-slide-up" style="animation-delay: 0.15s; opacity: 0; animation-fill-mode: forwards;">
                
                <a href="#" class="btn-card flex items-center p-4 rounded-2xl group hover:border-[#06C755]/50">
                    <div class="w-10 h-10 rounded-full bg-[#06C755]/10 text-[#06C755] flex items-center justify-center mr-4 group-hover:bg-[#06C755] group-hover:text-white transition-colors duration-300">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                         <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-0.5">LINE Official</span>
                         <span class="block text-sm font-bold text-theme-text group-hover:text-[#06C755] transition-colors">加入 LINE 官方帳號</span>
                    </div>
                    <i data-lucide="chevron-right" class="w-4 h-4 text-gray-300 group-hover:text-[#06C755]"></i>
                </a>

                <a href="#" class="btn-card flex items-center p-4 rounded-2xl group">
                     <div class="w-10 h-10 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center mr-4 group-hover:bg-theme-gold group-hover:text-white transition-colors">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                    </div>
                    <div class="flex-1">
                         <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-0.5">Location</span>
                         <span class="block text-sm font-bold text-theme-text group-hover:text-theme-gold transition-colors">台北市信義區 (Demo 地址)</span>
                    </div>
                    <i data-lucide="arrow-up-right" class="w-4 h-4 text-gray-300 group-hover:text-theme-gold"></i>
                </a>

                <div class="grid grid-cols-2 gap-3">
                    <div class="btn-card p-4 flex flex-col items-center justify-center gap-3 rounded-2xl group cursor-pointer">
                        <div class="w-10 h-10 rounded-full bg-theme-rose/10 text-theme-rose flex items-center justify-center group-hover:bg-theme-rose group-hover:text-white transition-colors duration-300">
                            <i data-lucide="phone" class="w-5 h-5"></i>
                        </div>
                        <div class="text-center">
                            <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-1">聯絡方式</span>
                            <span class="block text-sm font-bold text-theme-text font-en tracking-wider">0900-000-000</span>
                        </div>
                    </div>

                    <div class="btn-card p-4 flex flex-col items-center justify-center gap-3 rounded-2xl cursor-default">
                        <div class="w-10 h-10 rounded-full bg-theme-gold/10 text-theme-gold flex items-center justify-center">
                            <i data-lucide="clock-3" class="w-5 h-5"></i>
                        </div>
                        <div class="text-center">
                            <span class="block text-[10px] font-bold text-theme-sub tracking-widest uppercase mb-1">營業時間</span>
                            <span class="block text-sm font-bold text-theme-text font-en tracking-wider">10:00 – 19:00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div><div id="view-form" class="hidden pb-20 pt-20 safe-pb animate-fade-in">
            <header class="text-center mb-10 space-y-2">
                <span class="text-xs font-bold text-theme-gold tracking-[0.3em] uppercase block mb-2 font-en">Service Agreement</span>
                <h2 class="text-2xl font-black text-theme-text tracking-[0.2em] font-serif">寵物美容/住宿契約書</h2>
                <div class="flex items-center justify-center gap-2 text-theme-sub/60 mt-3">
                    <span class="h-px w-8 bg-theme-sub/30"></span>
                    <i data-lucide="paw-print" class="w-3 h-3"></i>
                    <span class="h-px w-8 bg-theme-sub/30"></span>
                </div>
            </header>

            <form id="petForm" class="space-y-6" onsubmit="event.preventDefault();" novalidate>

                <section class="glass-panel p-6 rounded-3xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-theme-rose"></div>
                    <h3 class="flex items-center gap-2 text-theme-text font-bold text-sm tracking-widest mb-6">
                        <i data-lucide="user-circle" class="w-5 h-5 text-theme-rose"></i> 飼主基本資料
                    </h3>
                    <div class="space-y-5">
                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">飼主姓名 <span class="text-theme-rose">*</span></label>
                            <input type="text" id="ownerName" required placeholder="請輸入姓名" class="input-minimal">
                        </div>
                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">電子信箱 <span class="text-theme-rose">*</span></label>
                            <input type="email" id="ownerEmail" required placeholder="example@mail.com" class="input-minimal">
                            <div class="error-msg">請檢查信箱格式</div>
                        </div>
                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">身分證字號 <span class="text-theme-rose">*</span></label>
                            <input type="text" id="ownerId" required maxlength="10" placeholder="A123456789" class="input-minimal" autocapitalize="characters">
                            <div class="error-msg">格式錯誤</div>
                        </div>
                        <div class="group input-group">
                            <label class="flex items-center flex-wrap gap-2 mb-1 cursor-pointer">
                                <span class="font-bold uppercase tracking-wider">
                                    聯絡手機 <span class="text-theme-rose">*</span>
                                </span>
                                <div class="flex items-center gap-1 text-theme-rose select-none">
                                    <i data-lucide="sparkles" class="w-3 h-3"></i>
                                    <span class="text-[11px] font-bold tracking-normal">
                                        Demo 模式：點搜尋直接帶入
                                    </span>
                                </div>
                            </label>                            
                            <div class="flex gap-2 items-stretch">
                                <div class="relative flex-1">
                                    <input type="tel" id="ownerPhone" required maxlength="10" placeholder="09xxxxxxxx" 
                                           class="input-minimal w-full h-full font-num tracking-widest text-lg" 
                                           inputmode="tel" oninput="handlePhoneInput(this)">
                                </div>
                                <button type="button" onclick="searchOldCustomer()" 
                                        class="shrink-0 px-4 rounded-xl bg-gradient-to-br from-theme-rose to-theme-roseDeep text-white font-bold text-sm shadow-md shadow-theme-rose/30 active:scale-95 transition-all flex flex-col items-center justify-center gap-0.5 min-w-[80px] group/btn relative overflow-hidden">
                                    <div class="absolute inset-0 bg-white/20 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"></div>
                                    <i data-lucide="search" class="w-5 h-5 relative z-10"></i>
                                    <span class="text-[10px] relative z-10">搜尋舊客</span>
                                </button>
                            </div>
                            <div class="error-msg">格式應為 09xxxxxxxx</div>
                        </div>
                        <div class="group input-group">
                             <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">通訊地址 <span class="text-theme-rose">*</span></label>
                            <input type="text" id="ownerAddress" required placeholder="請輸入地址" class="input-minimal">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="group input-group">
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">緊急聯絡人 <span class="text-theme-rose">*</span></label>
                                <input type="text" id="emergencyName" required placeholder="姓名" class="input-minimal">
                            </div>
                            <div class="group input-group">
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">緊急電話<span class="text-theme-rose">*</span></label>
                                <input type="tel" id="emergencyPhone" placeholder="電話" class="input-minimal">
                                <div class="error-msg">格式不符</div>
                            </div>
                        </div>
                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">指定就醫醫院</label>
                            <input type="text" id="hospital" placeholder="若無則送交特約醫院" class="input-minimal">
                        </div>
                    </div>
                </section><section class="glass-panel p-6 rounded-3xl relative overflow-hidden">
                     <div class="absolute top-0 left-0 w-1 h-full bg-theme-gold"></div>
                    <h3 class="flex items-center gap-2 text-theme-text font-bold text-sm tracking-widest mb-6">
                        <i data-lucide="cat" class="w-5 h-5 text-theme-gold"></i> 寵物詳細資料
                    </h3>
                    <div class="space-y-5">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="col-span-2 group input-group">
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">寵物名字 <span class="text-theme-rose">*</span></label>
                                <input type="text" id="petName" required placeholder="毛孩名字" class="input-minimal">
                            </div>
                            <div class="group input-group">
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">品種</label>
                                <input type="text" id="petBreed" placeholder="例: 英國短毛貓" class="input-minimal">
                            </div>
                            <div class="group input-group">
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">花色</label>
                                <input type="text" id="petColor" placeholder="例: 藍貓" class="input-minimal">
                            </div>
                        </div>

                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">寵物年齡 <span class="text-theme-rose">*</span></label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="petAge" required min="0" placeholder="請輸入數字" class="input-minimal flex-1" inputmode="numeric" oninput="detectRiskFactors()">
                                <span class="text-sm font-bold text-theme-text">歲</span>
                            </div>
                        </div>

                        <div class="group input-group">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">晶片號碼 <span class="text-theme-rose">*</span></label>
                            <div class="flex gap-3 items-end">
                                <div class="relative w-[150px] shrink-0">
                                    <select id="chipStatus" onchange="toggleChipInput()" class="input-minimal w-full appearance-none pr-6 cursor-pointer font-bold text-theme-text">
                                        <option value="has_chip">有晶片</option>
                                        <option value="unknown">有晶片(號碼不詳)</option>
                                        <option value="no_chip">無晶片</option>
                                    </select>
                                    <i data-lucide="chevron-down" class="absolute right-0 bottom-3 w-4 h-4 text-theme-sub pointer-events-none"></i>
                                </div>
                                <input type="text" id="petChip" placeholder="請輸入10或15碼數字" class="input-minimal flex-1">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">性別 *</label>
                                <div class="flex gap-2 mt-2 radio-group">
                                    <label class="flex-1 cursor-pointer"><input type="radio" name="petSex" class="peer hidden" value="公"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">公</div></label>
                                    <label class="flex-1 cursor-pointer"><input type="radio" name="petSex" class="peer hidden" value="母"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">母</div></label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">結紮 *</label>
                                <div class="flex gap-2 mt-2 radio-group">
                                    <label class="flex-1 cursor-pointer"><input type="radio" name="isNeutered" class="peer hidden" value="是"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">是</div></label>
                                    <label class="flex-1 cursor-pointer"><input type="radio" name="isNeutered" class="peer hidden" value="否"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">否</div></label>
                                </div>
                            </div>
                        </div>
                        
                         <div class="mb-5">
                             <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">具攻擊性 <span class="text-theme-rose">*</span></label>
                             <div class="flex gap-2 mt-2 radio-group">
                                <label class="flex-1 cursor-pointer"><input type="radio" name="isAggressive" class="peer hidden" value="是" onchange="detectRiskFactors()"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">是</div></label>
                                <label class="flex-1 cursor-pointer"><input type="radio" name="isAggressive" class="peer hidden" value="否" onchange="detectRiskFactors()"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">否</div></label>
                            </div>
                        </div>
                        <div class="group input-group">
                             <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">過往病史 <span class="text-theme-rose">*</span></label>
                             <div class="flex gap-2 mt-2 mb-3 radio-group">
                                <label class="flex-1 cursor-pointer"><input type="radio" name="hasHistory" value="有" class="peer hidden" onchange="detectRiskFactors()"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">有</div></label>
                                <label class="flex-1 cursor-pointer"><input type="radio" name="hasHistory" value="無" class="peer hidden" onchange="detectRiskFactors()"><div class="py-2 text-center border border-gray-200 rounded-lg transition text-sm font-bold text-gray-400 peer-checked:bg-theme-rose/10 peer-checked:border-theme-rose peer-checked:text-theme-text">無</div></label>
                            </div>
                            <textarea id="historyNotes" rows="2" placeholder="若有病史請詳述..." class="input-minimal resize-none bg-white/30 rounded-lg border border-gray-200 focus:border-theme-rose focus:ring-0 p-3 w-full"></textarea>
                        </div>
                    </div>
                </section>

                <section class="glass-panel p-6 rounded-3xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-theme-text"></div>
                    <h3 class="flex items-center gap-2 text-theme-text font-bold text-sm tracking-widest mb-6">
                        <i data-lucide="scissors" class="w-5 h-5 text-theme-text"></i> 本次服務內容
                    </h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="serviceType" value="精緻洗澡" class="peer hidden" onchange="toggleOtherServiceInput()">
                                <div class="h-full p-4 rounded-2xl border border-white/60 bg-white/40 shadow-sm backdrop-blur-sm transition-all duration-300 peer-checked:border-theme-rose peer-checked:bg-white peer-checked:shadow-lg flex flex-col items-center justify-center gap-2 text-center">
                                    <div class="w-10 h-10 rounded-full bg-white shadow-inner flex items-center justify-center text-theme-sub transition-colors peer-checked:bg-theme-rose peer-checked:text-white"><i data-lucide="droplets" class="w-5 h-5"></i></div>
                                    <span class="text-sm font-bold text-theme-text peer-checked:text-theme-rose">精緻洗澡</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="serviceType" value="大美容" class="peer hidden" onchange="toggleOtherServiceInput()">
                                <div class="h-full p-4 rounded-2xl border border-white/60 bg-white/40 shadow-sm backdrop-blur-sm transition-all duration-300 peer-checked:border-theme-rose peer-checked:bg-white peer-checked:shadow-lg flex flex-col items-center justify-center gap-2 text-center">
                                    <div class="w-10 h-10 rounded-full bg-white shadow-inner flex items-center justify-center text-theme-sub transition-colors peer-checked:bg-theme-rose peer-checked:text-white"><i data-lucide="scissors" class="w-5 h-5"></i></div>
                                    <span class="text-sm font-bold text-theme-text peer-checked:text-theme-rose">大美容/剃毛</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="serviceType" value="住宿" class="peer hidden" onchange="toggleOtherServiceInput()">
                                <div class="h-full p-4 rounded-2xl border border-white/60 bg-white/40 shadow-sm backdrop-blur-sm transition-all duration-300 peer-checked:border-theme-rose peer-checked:bg-white peer-checked:shadow-lg flex flex-col items-center justify-center gap-2 text-center">
                                    <div class="w-10 h-10 rounded-full bg-white shadow-inner flex items-center justify-center text-theme-sub transition-colors peer-checked:bg-theme-rose peer-checked:text-white"><i data-lucide="home" class="w-5 h-5"></i></div>
                                    <span class="text-sm font-bold text-theme-text peer-checked:text-theme-rose">住宿/安親</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="serviceType" value="其他項目" class="peer hidden" onchange="toggleOtherServiceInput()">
                                <div class="h-full p-4 rounded-2xl border border-white/60 bg-white/40 shadow-sm backdrop-blur-sm transition-all duration-300 peer-checked:border-theme-rose peer-checked:bg-white peer-checked:shadow-lg flex flex-col items-center justify-center gap-2 text-center">
                                    <div class="w-10 h-10 rounded-full bg-white shadow-inner flex items-center justify-center text-theme-sub transition-colors peer-checked:bg-theme-rose peer-checked:text-white"><i data-lucide="more-horizontal" class="w-5 h-5"></i></div>
                                    <span class="text-sm font-bold text-theme-text peer-checked:text-theme-rose">其他項目</span>
                                </div>
                            </label>
                             <div id="otherServiceInputArea" class="hidden col-span-2 animate-fade-in">
                                <input type="text" id="otherServiceDesc" placeholder="請說明服務內容..." class="input-minimal bg-theme-rose/5 border-theme-rose/20 focus:border-theme-rose">
                            </div>
                        </div>
                        <div class="mt-6 pt-6 border-t border-gray-100">
                            <label class="block text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-3">預計接回時間</label>
                            <div class="flex gap-3">
                                <button type="button" id="btn-notify-later" onclick="togglePickupTimeMode()" class="px-3 py-2 rounded-xl border border-theme-sub/20 bg-white/40 text-theme-sub text-xs font-bold hover:bg-theme-rose hover:text-white transition-all min-w-[80px]">另行通知</button>
                                <div class="relative flex-1">
                                    <input type="time" id="pickupTime" class="w-full bg-white/50 border border-gray-200 text-theme-text text-sm rounded-xl block w-full p-3 outline-none">
                                    <input type="text" id="pickupTimeText" value="另行通知接回時間" readonly class="hidden w-full bg-gray-100 border border-gray-200 text-theme-sub text-sm rounded-xl block p-3 text-center">
                                </div>
                            </div>
                        </div>
                    </section>

                <section class="glass-panel p-6 rounded-3xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-theme-gold"></div>
                    <h3 class="flex items-center gap-2 text-theme-text font-bold text-sm tracking-widest mb-6">
                        <i data-lucide="store" class="w-5 h-5 text-theme-gold"></i> 服務提供者 (Demo)
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-start gap-4">
                            <div class="w-8 h-8 rounded-full bg-theme-gold/10 text-theme-gold flex items-center justify-center shrink-0 mt-1"><i data-lucide="user" class="w-4 h-4"></i></div>
                            <div class="flex-1"><p class="text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">負責人</p><p class="text-sm font-bold text-theme-text">Li (開發柴)</p></div>
                        </div>
                        <div class="h-px bg-gray-100 w-full"></div>
                        <div class="flex items-start gap-4">
                            <div class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center shrink-0 mt-1"><i data-lucide="map-pin" class="w-4 h-4"></i></div>
                            <div class="flex-1"><p class="text-[10px] font-bold text-theme-sub uppercase tracking-wider mb-1">地址</p><p class="text-sm font-bold text-theme-text">台北市信義區 (Demo 地址)</p></div>
                        </div>
                    </div>
                </section>

                <section class="glass-panel p-0 rounded-3xl overflow-hidden">
                    <div class="p-6 space-y-4">
                        <button type="button" onclick="openTermsModal('general')" id="btn-general" class="w-full p-4 rounded-xl border border-theme-sub/20 bg-white/40 flex items-center justify-between group hover:border-theme-rose hover:bg-white/80 transition-all">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-theme-sub/10 flex items-center justify-center text-theme-sub"><i data-lucide="file-text" class="w-4 h-4"></i></div>
                                <div class="text-left"><span class="block text-sm font-bold text-theme-text">服務定型化契約</span><span class="text-[10px] text-theme-sub status-text">點擊閱讀完整條款</span></div>
                            </div>
                            <div class="check-icon hidden w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center"><i data-lucide="check" class="w-3.5 h-3.5"></i></div>
                        </button>
                        <button type="button" onclick="openTermsModal('risk')" id="btn-risk" class="hidden w-full p-4 rounded-xl border border-red-200 bg-red-50/50 flex items-center justify-between group">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-500"><i data-lucide="alert-triangle" class="w-4 h-4"></i></div>
                                <div class="text-left"><span class="block text-sm font-bold text-red-800">高齡/風險告知</span><span class="text-[10px] text-red-600/70 status-text">檢測到風險，請閱讀</span></div>
                            </div>
                            <div class="check-icon hidden w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center"><i data-lucide="check" class="w-3.5 h-3.5"></i></div>
                        </button>
                    </div>
                    <div class="p-4 bg-theme-rose/5 border-t border-theme-rose/10 flex justify-center transition-colors duration-300" id="agreeSection">
                        <label id="agreeLabel" class="flex items-center gap-3 cursor-pointer select-none opacity-50 pointer-events-none transition-all duration-300">
                            <input type="checkbox" id="agreeCheck" class="checkbox-custom">
                            <span class="text-xs font-bold text-theme-text tracking-wide" id="agreeText">本人已詳閱並同意以上條款內容</span>
                        </label>
                    </div>
                </section>

                <section class="glass-panel p-6 rounded-3xl">
                    <label class="block text-xs font-bold text-theme-sub mb-3 tracking-[0.2em] uppercase text-center font-en">Signature</label>
                    <div onclick="openSignatureModal()" class="w-full h-36 border border-theme-sub/20 rounded-2xl bg-white/40 shadow-inner flex items-center justify-center cursor-pointer hover:border-theme-rose/50 transition-all relative overflow-hidden group">
                        <div id="sign-placeholder" class="text-center group-hover:scale-105 transition duration-500">
                             <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-sm text-theme-rose/60 border border-white"><i data-lucide="pen-tool" class="w-5 h-5"></i></div>
                            <span class="text-xs font-bold text-theme-sub/50 tracking-widest">點擊此處開啟簽名</span>
                        </div>
                        <img id="sign-preview" class="hidden absolute inset-0 w-full h-full object-contain p-4" />
                    </div>
                    <div class="flex justify-between items-center mt-4 px-2">
                        <button type="button" onclick="clearSignature()" class="text-xs text-theme-sub hover:text-theme-rose flex items-center gap-1"><i data-lucide="rotate-ccw" class="w-3 h-3"></i> 重簽</button>
                        <span class="text-xs font-bold text-theme-text">簽署日期： <span id="signDate"></span></span>
                    </div>
                </section>

                <button onclick="submitForm(this)" class="w-full bg-gradient-lux text-white py-4 rounded-2xl font-bold shadow-lg shadow-theme-rose/30 active:scale-[0.98] transition-all flex items-center justify-center gap-3 tracking-[0.2em] text-lg mt-4 group overflow-hidden relative mb-safe">
                    <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                    <span class="relative z-10">確認並提交 (Demo)</span>
                    <i data-lucide="send" class="w-5 h-5 relative z-10 group-hover:translate-x-1 transition-transform"></i>
                </button>
                <div class="h-24 w-full"></div>
            </form>
        </div>
    </main><div id="signatureModal" class="fixed inset-0 z-[9999] hidden bg-theme-text/80 backdrop-blur-md flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-[#FAF8F5] w-full h-[100dvh] md:w-[95vw] md:h-[92vh] md:rounded-[32px] p-4 md:p-8 flex flex-col shadow-2xl transform translate-y-full transition-transform duration-500" id="modalContent">
            <div class="flex justify-between items-center mb-4 shrink-0">
                <button onclick="closeSignatureModal()" class="w-12 h-12 rounded-full bg-white border border-gray-200 flex items-center justify-center"><i data-lucide="x" class="w-6 h-6 text-gray-500"></i></button>
                <span class="font-bold text-xl text-theme-text tracking-widest font-serif">請在此簽名</span>
                <button onclick="saveSignature()" class="px-8 py-3 bg-theme-text text-white rounded-full font-bold hover:bg-black transition shadow-lg flex items-center gap-2">完成 <i data-lucide="check" class="w-5 h-5"></i></button>
            </div>
            <div class="flex-1 bg-white rounded-2xl border-2 border-dashed border-gray-300 shadow-inner overflow-hidden relative touch-none">
                <canvas id="signatureCanvas" class="w-full h-full cursor-crosshair"></canvas>
            </div>
            <div class="mt-4 flex justify-center shrink-0"><button onclick="clearCanvas()" class="flex items-center gap-2 text-base font-bold text-theme-sub hover:text-theme-rose px-6 py-3 bg-white rounded-full border shadow-sm"><i data-lucide="eraser" class="w-5 h-5"></i> 清除重寫</button></div>
        </div>
    </div>

    <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 glass-panel px-6 py-4 flex items-center gap-3 transform -translate-y-40 transition-all duration-500 z-[10000] rounded-full shadow-2xl min-w-[280px]">
        <div id="toastIconBg" class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center shrink-0"><i id="toastIcon" data-lucide="check" class="w-3.5 h-3.5 text-white stroke-[3]"></i></div>
        <span class="text-sm font-bold text-theme-text tracking-wider" id="toastMsg">操作成功</span>
    </div>

    <div id="termsModal" class="fixed inset-0 z-[9999] hidden bg-white flex flex-col transition-opacity duration-300 opacity-0">
        <div class="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-white/80 backdrop-blur-md shadow-sm shrink-0">
            <h3 id="modalTitle" class="font-bold text-lg text-theme-text tracking-widest font-serif">條款內容</h3>
            <button onclick="closeTermsModal()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
        <div id="modalContentBody" class="flex-1 overflow-y-auto p-6 text-sm leading-loose text-justify text-theme-text/80 space-y-4 pb-24 scroll-smooth"></div>
        <div class="absolute bottom-0 left-0 w-full p-6 bg-gradient-to-t from-white via-white to-white/0 pt-12 flex justify-center">
            <button id="modalConfirmBtn" onclick="confirmRead()" disabled class="w-full max-w-sm py-3 rounded-full bg-gray-300 text-white font-bold tracking-widest shadow-lg transition-all duration-300 flex items-center justify-center gap-2 cursor-not-allowed"><span>請滑動至底部</span> <i data-lucide="arrow-down" class="w-4 h-4 animate-bounce"></i></button>
        </div>
    </div>
    
    <div id="petSelectModal" class="fixed inset-0 z-[9999] hidden bg-black/20 backdrop-blur-[2px] flex items-center justify-center opacity-0 transition-opacity duration-300">
        <div class="bg-[#FAF8F5] w-[90%] max-w-sm rounded-[32px] p-6 shadow-2xl transform scale-95 transition-transform duration-300 border border-white/50" id="petSelectContent">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-theme-rose/10 rounded-full flex items-center justify-center mx-auto mb-4"><i data-lucide="cat" class="w-8 h-8 text-theme-rose"></i></div>
                <h3 class="text-xl font-bold text-theme-text font-serif tracking-widest mb-1">Demo 模式</h3>
                <p class="text-xs text-theme-sub tracking-wider">為您模擬帶入一筆測試用的貓咪資料</p>
            </div>
            <div id="petListContainer" class="space-y-3 mb-4"></div>
            <button onclick="closePetSelectModal()" class="w-full py-3 rounded-xl border border-gray-300 text-gray-500 font-bold text-sm hover:bg-gray-50 transition">關閉</button>
        </div>
    </div>

    <script>
        lucide.createIcons();
        const today = new Date();
        document.getElementById('signDate').innerText = `${today.getFullYear()}/${today.getMonth()+1}/${today.getDate()}`;

        // --- 路由 ---
        function router(page) {
            const home = document.getElementById('view-home');
            const form = document.getElementById('view-form');
            const navbar = document.getElementById('navbar');
            window.scrollTo({top: 0, behavior: 'smooth'});
            if (page === 'form') {
                home.style.display = 'none';
                form.classList.remove('hidden');
                navbar.classList.remove('opacity-0', 'pointer-events-none');
            } else {
                form.classList.add('hidden');
                home.style.display = 'flex';
                navbar.classList.add('opacity-0', 'pointer-events-none');
            }
        }

        // --- 互動邏輯 ---
        function toggleOtherServiceInput() {
            const isOther = document.querySelector('input[name="serviceType"][value="其他項目"]').checked;
            const inputArea = document.getElementById('otherServiceInputArea');
            if (isOther) { inputArea.classList.remove('hidden'); setTimeout(() => document.getElementById('otherServiceDesc').focus(), 100); } 
            else { inputArea.classList.add('hidden'); document.getElementById('otherServiceDesc').value = ''; }
        }

        function toggleChipInput() {
            const status = document.getElementById('chipStatus').value;
            const input = document.getElementById('petChip');
            if (status === 'no_chip' || status === 'unknown') {
                input.value = ''; input.disabled = true; input.placeholder = status === 'no_chip' ? '無晶片免填' : '號碼不詳'; input.style.backgroundColor = 'transparent';
            } else {
                input.disabled = false; input.placeholder = '請輸入10或15碼數字'; input.style.backgroundColor = '';
            }
        }

        let isNotifyLater = false;
        function togglePickupTimeMode() {
            isNotifyLater = !isNotifyLater;
            const timeInput = document.getElementById('pickupTime');
            const textInput = document.getElementById('pickupTimeText');
            const btn = document.getElementById('btn-notify-later');
            if (isNotifyLater) {
                timeInput.classList.add('hidden'); textInput.classList.remove('hidden');
                btn.classList.add('bg-theme-rose', 'text-white', 'border-theme-rose'); btn.classList.remove('bg-white/40', 'text-theme-sub');
            } else {
                timeInput.classList.remove('hidden'); textInput.classList.add('hidden');
                btn.classList.remove('bg-theme-rose', 'text-white', 'border-theme-rose'); btn.classList.add('bg-white/40', 'text-theme-sub');
            }
        }

        function handlePhoneInput(input) { input.value = input.value.replace(/[^\d]/g, ''); }

        // --- 條款邏輯 ---
        const TERMS_CONTENT = {
            general: `<p><strong>本契約為開發柴工作室之展示範本。</strong></p><p>一、此為 Demo 版本，不具法律效力。</p><p>二、所有資料僅供前端展示，重整即消失。</p><div class="h-20"></div>`,
            risk: `<p class="font-bold text-red-600 mb-2">高齡/特殊風險告知 (Demo)</p><p>此為展示用風險告知視窗。</p><div class="h-20"></div>`
        };
        let readStatus = { general: false, risk: false };
        let currentReading = '';
        let isHighRisk = false;

        function detectRiskFactors() {
            const age = parseInt(document.getElementById('petAge').value) || 0;
            const isAggressive = document.querySelector('input[name="isAggressive"]:checked')?.value === '是';
            const hasHistory = document.querySelector('input[name="hasHistory"]:checked')?.value === '有';
            let reasons = [];
            if(age >= 10) reasons.push("高齡"); if(isAggressive) reasons.push("攻擊性"); if(hasHistory) reasons.push("病史");
            
            const btnRisk = document.getElementById('btn-risk');
            const agreeText = document.getElementById('agreeText');

            if (reasons.length > 0) {
                isHighRisk = true;
                btnRisk.classList.remove('hidden'); btnRisk.classList.add('flex');
                if(readStatus.risk) { readStatus.risk = false; updateButtonUI('risk', false); }
                agreeText.innerText = `本人已詳閱並同意 (${reasons.join('、')})`;
            } else {
                isHighRisk = false;
                btnRisk.classList.add('hidden'); btnRisk.classList.remove('flex');
                agreeText.innerText = "本人已詳閱並同意以上契約條款";
            }
            checkAllRead();
        }

        function updateButtonUI(type, isDone) {
            const btn = document.getElementById(`btn-${type}`);
            const checkIcon = btn.querySelector('.check-icon');
            if (isDone) { btn.classList.add('border-green-500', 'bg-green-50'); if(type==='risk') btn.classList.remove('border-red-200'); checkIcon.classList.remove('hidden'); }
            else { btn.classList.remove('border-green-500', 'bg-green-50'); if(type==='risk') btn.classList.add('border-red-200'); checkIcon.classList.add('hidden'); }
        }

        function checkAllRead() {
            const agreeLabel = document.getElementById('agreeLabel');
            const agreeSection = document.getElementById('agreeSection');
            let allDone = isHighRisk ? (readStatus.general && readStatus.risk) : readStatus.general;
            if (allDone) { agreeLabel.classList.remove('opacity-50', 'pointer-events-none'); agreeSection.classList.replace('bg-theme-rose/5', 'bg-green-50/50'); }
            else { agreeLabel.classList.add('opacity-50', 'pointer-events-none'); document.getElementById('agreeCheck').checked = false; agreeSection.classList.replace('bg-green-50/50', 'bg-theme-rose/5'); }
        }

        function openTermsModal(type) {
            currentReading = type;
            const modal = document.getElementById('termsModal');
            document.getElementById('modalContentBody').innerHTML = TERMS_CONTENT[type];
            modal.classList.remove('hidden'); setTimeout(()=>modal.classList.remove('opacity-0'),10);
            
            // Auto enable for demo
            setTimeout(()=> {
                const btn = document.getElementById('modalConfirmBtn');
                btn.disabled = false; btn.classList.remove('bg-gray-300', 'cursor-not-allowed'); btn.classList.add('bg-theme-text');
                btn.innerHTML = `<span>我已詳閱並同意</span> <i data-lucide="check" class="w-4 h-4"></i>`;
                lucide.createIcons();
            }, 500);
        }
        function closeTermsModal() { document.getElementById('termsModal').classList.add('opacity-0'); setTimeout(()=>document.getElementById('termsModal').classList.add('hidden'),300); }
        function confirmRead() { readStatus[currentReading] = true; updateButtonUI(currentReading, true); closeTermsModal(); checkAllRead(); }

        // --- 簽名板 ---
        let signaturePad = null;
        const sigModal = document.getElementById('signatureModal');
        const sigCanvas = document.getElementById('signatureCanvas');

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            sigCanvas.width = sigCanvas.offsetWidth * ratio; sigCanvas.height = sigCanvas.offsetHeight * ratio;
            sigCanvas.getContext("2d").scale(ratio, ratio);
        }
        function openSignatureModal() {
            sigModal.classList.remove('hidden'); document.body.style.overflow = 'hidden';
            setTimeout(()=> { sigModal.classList.remove('opacity-0'); document.getElementById('modalContent').classList.remove('translate-y-full'); }, 10);
            resizeCanvas();
            if (!signaturePad) signaturePad = new SignaturePad(sigCanvas, { minWidth: 1.5, maxWidth: 3.5, penColor: '#4A4238' });
        }
        function closeSignatureModal() {
            document.getElementById('modalContent').classList.add('translate-y-full'); sigModal.classList.add('opacity-0'); document.body.style.overflow = '';
            setTimeout(()=> sigModal.classList.add('hidden'), 500);
        }
        function clearCanvas() { if(signaturePad) signaturePad.clear(); }
        function clearSignature() { document.getElementById('sign-preview').classList.add('hidden'); document.getElementById('sign-placeholder').classList.remove('hidden'); if(signaturePad) signaturePad.clear(); }
        function saveSignature() {
            if (signaturePad.isEmpty()) { showToast('請先簽名', false); return; }
            document.getElementById('sign-preview').src = signaturePad.toDataURL();
            document.getElementById('sign-preview').classList.remove('hidden'); document.getElementById('sign-placeholder').classList.add('hidden');
            closeSignatureModal();
        }

        // --- Mock 搜尋功能 ---
        function searchOldCustomer() {
            // 模擬資料 (貓)
            const mockCat = {
                owner_name: '陳小美', owner_email: 'demo@shiba.studio', owner_id: 'A223456789',
                owner_address: '台北市信義區忠孝東路五段...', emergency_name: '陳大文', emergency_phone: '0911222333',
                pet_name: '咪咪 (Demo)', pet_breed: '曼赤肯', pet_color: '橘白', pet_age: 3,
                pet_sex: '母', is_neutered: '是', is_friendly: '是', is_aggressive: '否', has_history: '無'
            };
            
            const container = document.getElementById('petListContainer');
            container.innerHTML = '';
            const btn = document.createElement('button');
            btn.className = 'w-full text-left p-4 rounded-2xl bg-white border border-gray-100 shadow-sm hover:border-theme-rose transition group';
            btn.onclick = () => {
                document.getElementById('ownerName').value = mockCat.owner_name;
                document.getElementById('petName').value = mockCat.pet_name;
                document.getElementById('petBreed').value = mockCat.pet_breed;
                document.getElementById('petColor').value = mockCat.pet_color;
                document.getElementById('petAge').value = mockCat.pet_age;
                // Radio buttons mock fill...
                closePetSelectModal();
                showToast(`已載入 ${mockCat.pet_name} 的資料`, true);
            };
            btn.innerHTML = `<div><span class="block text-lg font-bold text-theme-text group-hover:text-theme-rose">${mockCat.pet_name}</span><span class="text-xs text-theme-sub">品種：${mockCat.pet_breed}</span></div>`;
            container.appendChild(btn);

            const modal = document.getElementById('petSelectModal');
            modal.classList.remove('hidden'); setTimeout(()=>modal.classList.remove('opacity-0'), 10);
        }
        function closePetSelectModal() { document.getElementById('petSelectModal').classList.add('opacity-0'); setTimeout(()=>document.getElementById('petSelectModal').classList.add('hidden'), 300); }

        // --- Mock 提交功能 ---
        function submitForm(btn) {
            if(!document.getElementById('agreeCheck').checked) { showToast('請同意服務條款', false); return; }
            // 簡單驗證簽名
            if(document.getElementById('sign-preview').classList.contains('hidden')) { showToast('請完成簽名', false); return; }
            
            const originalContent = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-5 h-5"></i><span class="ml-2">Demo 提交中...</span>`;
            btn.disabled = true;

            setTimeout(() => {
                showToast('Demo 提交成功！', true);
                btn.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5"></i><span class="ml-2">完成</span>`;
                btn.classList.replace('bg-gradient-lux', 'bg-green-500');
                
                setTimeout(() => {
                    router('home');
                    btn.innerHTML = originalContent;
                    btn.disabled = false;
                    btn.classList.remove('bg-green-500'); btn.classList.add('bg-gradient-lux');
                    document.getElementById('petForm').reset();
                    clearSignature();
                }, 1500);
            }, 1500);
        }

        function showToast(msg, isSuccess = true) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMsg').innerText = msg;
            const icon = document.getElementById('toastIcon');
            document.getElementById('toastIconBg').className = isSuccess ? "w-6 h-6 rounded-full bg-green-500 flex items-center justify-center" : "w-6 h-6 rounded-full bg-red-500 flex items-center justify-center";
            icon.setAttribute('data-lucide', isSuccess ? 'check' : 'alert-circle');
            lucide.createIcons();
            toast.classList.remove('-translate-y-40'); toast.classList.add('translate-y-0');
            setTimeout(() => { toast.classList.add('-translate-y-40'); toast.classList.remove('translate-y-0'); }, 3000);
        }
    </script>
</body>
</html>